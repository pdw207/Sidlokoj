<h1>Edit an Existing Class</h1>

<div class="row">
  <%= simple_form_for @course do |f| %>

  <div class="small-4 columns">
    <div id="panel1" class="content active">
      <dl class="tabs" data-tab>
        <dd class="active"><a href="#panel2-1">Students</a></dd>
        <dd><a href="#panel2-2">Edit</a></dd>
      </dl>
      <div class="tabs-content">
        <div class="content active" id="panel2-1">

          <% @student_pool.each do |student| %>
          <%= image_tag student.student_photo.url, class: "small-photo photo-draggable", draggable: true, data: {student_id: student.id} %>
          <%end %>
        </div>

        <div class="content" id="panel2-2">
          <%= f.input :subject%>
          <div class="row">
            <div class="small-6 columns"><%= f.input :school_year, label: "School Year" %></div>
            <div class="small-6 columns"><%= f.input :period %></div>
          </div>
          <div class="row">
            <div class="small-6 columns"><%= f.input :rows, label: "Rows in Classroom" %></div>
            <div class="small-6 columns"><%= f.input :columns, label: "Students Per Row" %></div>
          </div>
          <%= f.input :status, collection: Course::STATUSES, :include_blank => false %>
          <%= f.input :start_date, label: "Start", input_html: {class: "medium-4 columns "} %>
          <%= f.input :end_date, label: "End", input_html: {class: "medium-4 columns "} %>
        </div>
      </div>
    </div>
  </div>

  <div class="small-8 columns">
    <div class="row seatingchart">
      <ul class="small-block-grid-<%= @course.columns %>">
        <% @course.size.times do |n| %>
        <li>
          <%= image_tag "http://placehold.it/100x100&text=Seat_#{n+1}", class: "medium-photo photo-draggable", draggable: true ,data: { seat: n }%>
        </li>
        <% end %>
      </ul>
      <ul class="small-block-grid-<%= @course.columns %>">
        <% counter = 0 %>
        <%= f.simple_fields_for :enrollments do |e| %>
        <li>
          <%= e.input :seat,  input_html: { value: e.object.seat },  as: :hidden%>
          <%= e.input :id,  input_html: { value: e.object.id },  as: :hidden%>
          <% label = "Seat " + (counter+=1).to_s %>
          <%= e.association :student,
          collection: @student_pool,
          label_method: :full_name,
          value_method: :id,
          label: label %>
        </li>
        <% end %>
      </ul>

      <%= f.button :submit, "Modify" %>
    </div>
  </div>
  <% end %>

  <div class="row">
    <div id="course_modify" class="small-12 small-centered">

    </div>
  </div>
</div>



<footer>
  <p><%= link_to 'Back', root_path %></p>
</footer>

<%content_for :extra_footer do %>
<script>
  $(function() {

    function addListeners(){
      var dragSrcEl;
      var students = document.querySelectorAll('.photo-draggable');
      [].forEach.call(students, function(student) {
        // Source
        student.addEventListener('dragstart', handleDragStart, false);
        student.addEventListener('dragend', handleDragEnd, false);
        //Target
        student.addEventListener('dragenter', handleDragEnter, false);
        student.addEventListener('dragleave', handleDragLeave, false);
        student.addEventListener('dragover', handleDragOver, false);
        student.addEventListener('drop', handleDrop, false);

      });
    };

    // Add listeners on all photos
    addListeners();

    // Set the source to null
    var dragSrcEl = null

    function handleDragStart(e) {
      this.style.opacity = '0.4';
      dragSrcEl = this;
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/html', this.innerHTML);
    }

    function handleDragOver(e) {
      if (e.preventDefault) {
        e.preventDefault();
      }

      e.dataTransfer.dropEffect = 'move';

      return false;
    }
    function handleDragEnd(e) {
      this.style.opacity = '1.0';

    }

    function handleDrop(e){
      if (e.stopPropagation) {
        e.stopPropagation();
      }
      if (dragSrcEl != this) {
        // Set  Photos on drop
        var sourcePhoto = dragSrcEl.src
        var targetPhoto = this.src

        // Update Photos
        this.src = sourcePhoto
        dragSrcEl.src = targetPhoto


        // Update hidden Form
        var studentId = $(dragSrcEl).attr('data-student-id')
        var seatNumber = $(this).attr('data-seat')
        var selectFormId = '#course_enrollments_attributes_'  + seatNumber + '_student_id'

        $(selectFormId).val(studentId)




      }
    }

    function handleDragEnter(e){
      e.preventDefault();

      // If object is not original object then...
      if (dragSrcEl != this) {
        console.log('enter')
      }

    }
    function handleDragLeave(e){
      e.preventDefault();
      console.log("leave");
    }
  })

</script>
<% end %>

.val method in form









